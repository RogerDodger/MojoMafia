<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title><%= title %></title>

		<meta name="description" content="Mafia party game web application message board forum">
		<meta name="viewport" content="width=device-width">

		<link rel="icon" href="/favicon.ico">

		<link rel="stylesheet" href="/style/vendor/normalize.css">
		<link rel="stylesheet" href="/style/mafia-<%= app()->meta('version') %>.css" id="main-stylesheet">

		<script src="/js/vendor/modernizr-2.6.2.min.js"></script>
		<script>
			%= include 'includes/session', format => 'js'
		</script>
	</head>

	<body>
		<nav class="top">
			<div class="container clearfix">
				<header><a href="/">MojoMafia</a></header>

				<div class="divider"></div>

				<ul class="public">
					<li><a href="#">Games</a></li>
					<li><a href="#">Setups</a></li>
					<li><a href="#">About</a></li>
					<li><a href="#">Forum</a></li>
				</ul>

				<div class="divider"></div>

				<ul class="user">
					% if (user) {
						<li class="name">
							<a href="#" title="User profile">
								<i class="icon-user"></i>
								<%= user()->name %>
							</a>
						</li>
						<li>
							<a href="#">
								<i class="icon-cog"></i>
								Settings
							</a>
						</li>
					% }

					% if (user || current_route eq 'register') {
						<li>
							<a href="#" id="logout">
								<i class="icon-signout"></i>
								Logout
							</a>
						</li>
					% } else {
						<li>
							<a href="#" id="login">
								<i class="icon-signin"></i>
								Login
							</a>
						</li>
					% }
				</ul>
			</div>
		</nav>

		<article class="main clearfix">
			<section class="content <%= 'no-sidebar' if stash 'no_sidebar' %>">
				<%= content %>
			</section>

			% unless (stash 'no_sidebar') {
				<section class="sidebar">

					% if (defined stash 'game') {
						<aside class="game">
							<h1>Game #<%= stash('game')->id %></h1>
							<p>
								Using setup
								<a href="/setup/<%= stash('game')->setup_id %>">
									<%= stash('game')->setup->name %>
								</a>
								<br>
								It is currently
								<span class="datetime">
									<%= ucfirst stash('game')->datetime %>
								</span>
							</p>
						</aside>
					% }

					% if (defined stash 'player') {
						<aside class="player">
							<h1>Player</h1>
							<p>
								Your alias is
								<span class="alias">
									<%= stash('player')->alias %>
								</span>
								<br>
								You are a
								<span class="role">
									<%= stash('player')->role %>
								</span>
							</p>
						</aside>
					% }

					% if (defined stash('game')) {
						<aside class="players">
							<h1>Players</h1>
							<ul>
								% for my $player (stash('game')->players->sorted->all) {
									<li>
										% if ($player->is_alive) {
											<%= $player->name %>
										% } else {
											<del><%= $player->name %></del>
											<span class="role <%= $player->role %>">
												(<%= ucfirst $player->role %>)
											</span>
										% }
									</li>
								% }
							</ul>
						</aside>
					% }

					% if (defined stash('votes') && stash('votes')->count) {
						<aside class="votes">
							<h1>Votes</h1>
							<table>
								% for my $voter (stash('votes')->all) {
									<tr>
										<td class="player"><%= $voter->name %></td>
										<td class="vote"><%= eval { $voter->vote->name } %></td>
									</tr>
								% }
							</table>
						</aside>
					% }

					% if (defined stash('games') && stash('games')->count) {
						<aside class="games">
							<h1>Active games</h1>
							<ul>
								% for my $game (stash('games')->all) {
									<li>
										<span class="id">#<%= $game->id %></span>
										<span class="setup"><%= $game->setup->name %></span>
									</li>
								% }
							</ul>
						</aside>
					% }

				</section>
			% }
		</article>

		<footer>
			<div class="content clearfix">
				<article class="about">
					<h1>MojoMafia <%= app()->meta('version') %></h1>
					<ul>
						<li><a href="https://github.com/RogerDodger/MojoMafia">Source code</a></li>
						<li><a href="/humans.txt">Contributors</a></li>
					</ul>
				</article>

				<article class="legal">
					<h1>Legal</h1>
					<ul>
						<li><a href="/privacy">Privacy policy</a></li>
						<li><a href="/tos">Terms of service</a></li>
					</ul>
				</article>

				<article class="help">
					<h1>Help</h1>
					<ul>
						<li><a href="/contact">Contact a human</a></li>
					</ul>
				</article>

				<div class="clearfix"></div>

				<p class="sosumi">
					Except where otherwise noted, all site content is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_GB">Creative Commons Attribution 3.0 Unported License</a>.
				</p>
			</div>
		</footer>

		<script src="/js/vendor/jquery-1.8.3.min.js"></script>
		<script src="/js/vendor/jquery-fieldselection-0.1.1.min.js"></script>
		<script src="https://login.persona.org/include.js"></script>
		<script src="/js/mafia-<%= app()->meta('version') %>.js"></script>

		% if (defined config 'ga') {
			<script>
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', '<%= config "ga" %>']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
			</script>
		% }
	</body>
</html>
