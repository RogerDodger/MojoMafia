<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title><%= title %></title>

		<meta name="description" content="Mafia party game web application message board forum">
		<meta name="viewport" content="width=device-width">

		<link rel="icon" href="<%= url_for '/favicon.ico' %>">

		<link rel="stylesheet" href="<%= url_for '/style/normalize.css' %>">

		% if (app->mode eq 'development') {
			<link rel="stylesheet/less" href="<%= url_for '/style/mafia.less' %>">
			<script src="<%= url_for '/js/vendor/less-1.3.3.min.js' %>"></script>
		% } else {
			<link rel="stylesheet" href="<%= url_for('/style/mafia.css')
				->query(v => meta('version') =~ s/v//r) %>">
		% }

		<script src="<%= url_for '/js/vendor/modernizr-2.6.2.min.js' %>"></script>
	</head>

	<body>
		<nav class="top">
			<div class="container clearfix">
				<header><a href="<%= url_for '/' %>">MojoMafia</a></header>

				<div class="divider"></div>

				<ul class="public">
					<li><a href="#">Games</a></li>
					<li><a href="#">Setups</a></li>
					<li><a href="#">About</a></li>
					<li><a href="#">Forum</a></li>
				</ul>

				<div class="divider"></div>

				<ul class="user">
					% if (defined user) {
						<li class="name">
							<a href="#" title="User profile">
								<span class="icon">&#128100;</span>
								<%= user->name %>
							</a>
						</li>
						<li><a href="#" class="icon" title="Change settings">&#9874;</a></li>
						<li><a href="<%= url_for '/user/logout' %>" 
							class="icon" title="Logout">&#59201;</a></li>
					% } else {
						<li><a href="#" class="icon" title="Sign up">&#10002;</a></li>
						<li><a href="<%= url_for '/user/login' %>"
							class="icon" title="Login">&#59200;</a></li>
					% }
				</ul>
			</div>
		</nav>

		<article class="main clearfix">
			<section class="content <%= 'no-sidebar' if stash 'no_sidebar' %>">
				<%= content %>
			</section>

			% unless (stash 'no_sidebar') {
				<section class="sidebar">

					% if (defined stash 'game') {
						<aside class="game">
							<h1>Game #<%= stash('game')->id %></h1>
							<p>
								It is currently 
								<span class="datetime">
									<%= ucfirst stash('game')->datetime %>
								</span>
							</p>
						</aside>
					% }

					% if (defined stash 'player') {
						<aside class="player">
							<h1>Player</h1>
							<p>
								% if (defined stash('player')->alias) {
									Your alias is
									<span class="alias">
										<%= stash('player')->alias %>
									</span>
									<br>
								% }
								You are a 
								<span class="role">
									<%= ucfirst stash('player')->role->name %>
								</span>
								<span class="team <%= stash('player')->team->name %>">
									(<%= ucfirst stash('player')->team->name %>)
								</span>
							</p>
						</aside>
					% }

					% if (defined stash('game')) {
						<aside class="players">
							<h1>Players</h1>
							<ul>
								% for my $player (stash('game')->players->all) {
									<li>
										% if ($player->is_alive) {
											<%= $player->name %>
										% } else {
											<del><%= $player->name %></del>
											<span class="team <%= $player->team->name %>">
												(<%= ucfirst $player->team->name %>)
											</span>
										% }
									</li>
								% }
							</ul>
						</aside>
					% }

					% if (defined stash('votes') && stash('votes')->count) {
						<aside class="votes">
							<h1>Votes</h1>
							<table>
								% for my $voter (stash('votes')->all) {
									<tr>
										<td class="player"><%= $voter->name %></td>
										<td class="vote"><%= eval { $voter->vote->name } %></td>
									</tr>
								% }
							</table>
						</aside>
					% }

					% if (defined stash('games') && stash('games')->count) {
						<aside class="games">
							<h1>Active games</h1>
							<ul>
								% for my $game (stash('games')->all) {
									<li>
										<span class="id">#<%= $game->id %></span>
										<span class="setup"><%= $game->setup->title %></span>
									</li>
								% }
							</ul>
						</aside>
					% }

				</section>
			% }
		</article>

		<footer>
			<div class="content clearfix">
				<article class="about">
					<h1>MojoMafia <%= meta 'version' %></h1>
					<ul>
						<li><a href="https://github.com/RogerDodger/MojoMafia">Github</a></li>
						<li><a href="<%= url_for '/humans.txt' %>">Contributors</a></li>
					</ul>
				</article>

				<article class="legal">
					<h1>Legal</h1>
					<ul>
						<li><a href="<%= url_for '/privacy' %>">Privacy policy</a></li>
						<li><a href="<%= url_for '/tos' %>">Terms of service</a></li>
					</ul>
				</article>

				<article class="help">
					<h1>Help</h1>
					<ul>
						<li><a href="<%= url_for '/contact' %>">Contact a human</a></li>
					</ul>
				</article>

				<div class="clearfix"></div>

				<p class="sosumi">
					Except where otherwise noted, all site content is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_GB">Creative Commons Attribution 3.0 Unported License</a>.
				</p>
			</div>
		</footer>

		<script src="<%= url_for '/js/vendor/jquery-1.8.3.min.js' %>"></script>
		<script src="<%= url_for '/js/vendor/jquery-fieldselection-0.1.1.min.js' %>"></script>
		
		% if(app->mode eq 'development') {
			% for my $fn (glob 'public/js/src/*.js') {
				<script src="<%= url_for $fn =~ s/^public//r %>"></script>
			% }
		% } else {
			<script src="<%= url_for('/js/mafia.min.js')
				->query(v => meta('version') =~ s/v//r) %>"></script>
		% }

		% if (defined config 'ga') {
			<script>
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', '<%= config "ga" %>']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
			</script>
		% }
	</body>
</html>
